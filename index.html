<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Get download link from an url</title>
  </head>
  <body>
    <h1>Enter the url below and get a download link.</h1>
    <input type="submit" id="mojicola-btn" value="Get a free Sprite!" />
    <br />
    <input type="text" id="input-link" />
    <input type="submit" id="qq-btn" value="From QQ K-song" />
    <hr />
    <div id="output-con"></div>

    <em><a href="https://github.com/bdbai/supreme-getlink">Fork me on GitHub!</a></em>

    <script type="text/javascript">
      var inputTxt = document.getElementById('input-link');
      var outputCon = document.getElementById('output-con');
      var head = document.getElementsByTagName('head')[0];
      var qqBtn = document.getElementById('qq-btn');
      var mojiColaBtn = document.getElementById('mojicola-btn');

      function jsonp(url) {
          var scriptEl = document.createElement('script');
          scriptEl.src = url;
          head.appendChild(scriptEl);
      }

      function qqkgCallback(result) {
          var linkEl = document.createElement('a');
          var linkUrl = result.data.playurl;
          linkEl.href = linkUrl;
          linkEl.innerText = linkUrl;
          outputCon.appendChild(linkEl);
      }
      function mojiColaCallback(result) {
          var resultEl = document.createElement('p');
          if (result.code !== 0) {
              alert(result.msg);
              return;
          }          
          resultEl.text = result.data.activity;
          alert(result.data.activity);
          resultEl.innerText = result.textContent = 'Your promotion code: ' + result.data.activity;
          outputCon.appendChild(resultEl);
      }

      qqBtn.addEventListener('click', function(e) {
          e.preventDefault();
          var inputUrl = inputTxt.value;
          var sidReg = /s=(.*?)(&|$)/;
          var shareId = inputUrl.match(sidReg)[1];
          jsonp('http://cgi.kg.qq.com/fcgi-bin/kg_ugc_getdetail?callback=qqkgCallback&inCharset=utf-8&outCharset=utf-8&v=3&shareid=' + shareId);
      });
      mojiColaBtn.addEventListener('click', function(e) {
          e.preventDefault();
          jsonp('http://co.moji.com/api/cola/raffle?activityid=MC2016062101&callback=mojiColaCallback');
      });
     </script>
  </body>
</html>
